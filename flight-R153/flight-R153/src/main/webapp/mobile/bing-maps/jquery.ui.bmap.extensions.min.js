(function($){$.extend($.ui.gmap.prototype,{getCurrentPosition:function(callback,geoPositionOptions){var map=this.get('map'),opts={}||geoPositionOptions;opts.successCallback=function(position){callback(position,"OK");};opts.errorCallback=function(error){callback(null,(error.code===5)?'NOT_SUPPORTED':error.code);};var geolocation=this.get('geolocation',new Microsoft.Maps.GeoLocationProvider(map));geolocation.getCurrentPosition(opts)},watchPosition:function(a,b){var c=this;if(navigator.geolocation){this.set('watch',navigator.geolocation.watchPosition(function(d){c._call(a,d,"OK");},function(error){c._call(a,null,error);},b));}else{c._call(a,null,"NOT_SUPPORTED");}},clearWatch:function(){if(navigator.geolocation){navigator.geolocation.clearWatch(this.get('watch'));}},pagination:function(prop){var $el=$("<div id='pagination' class='pagination shadow gradient rounded clearfix'><div class='lt btn back-btn'></div><div class='lt display'></div><div class='rt btn fwd-btn'></div></div>");var self=this,i=0,prop=prop||'title';self.set('p_nav',function(a,b){if(a){i=i+b;$el.find('.display').text(self.get('markers')[i][prop]);self.get('map').setView({'center':self.get('markers')[i].getLocation()});}});self.get('p_nav')(true,0);$el.find('.back-btn').click(function(){self.get('p_nav')((i>0),-1,this);});$el.find('.fwd-btn').click(function(){self.get('p_nav')((i<self.get('markers').length-1),1,this);});self.addControl($el,0);},createCluster:function(arrayOfLocations){var self=this;Microsoft.Maps.registerModule('clusterModule','http://www.bingmapsportal.com/Scripts/V7ClientSideClustering.js');Microsoft.Maps.loadModule('clusterModule',{callback:function(){self.clear('markers');var clusteredCollection=new ClusteredEntityCollection(self.get('map'),{singlePinCallback:function(data){var pushPin=new Microsoft.Maps.Pushpin(data._LatLong,{'icon':'http://www.bingmapsportal.com/Content/nonclusteredpin.png','anchor':new Microsoft.Maps.Point(8,8)});pushPin.title=data.Title;pushPin.description=data.Description;pushPin.GridKey=data.GridKey;$(pushPin).click(function(){self.openInfoWindow({'title':this.target.title,'description':this.target.description},this);});return pushPin;},clusteredPinCallback:function(cluster,latlong){return new Microsoft.Maps.Pushpin(latlong,{'icon':'http://www.bingmapsportal.com/Content/clusteredpin.png','anchor':new Microsoft.Maps.Point(8,8)});}});clusteredCollection.SetData(arrayOfLocations);}});}});}(jQuery));